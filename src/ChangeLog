2007-09-21  Werner Koch  <wk@g10code.com>

	* registry.c (default_homedir): Make registry works.  Reported by
	Marc Mutz.

2007-09-16  Marcus Brinkmann  <marcus@g10code.de>

	* gpgex.cc (gpgex_t::QueryContextMenu): Implement popup menu
	correctly, such that the explorer can clean up correctly (in the
	file dialog).
	(gpgex_t::GetCommandString): Implement help texts.
	(start_help): New function.
	(gpgex_t::InvokeCommand): Call start_help.
	* Makefile.am (gpgex_LDADD): Add -loleaut32.

2007-09-11  Marcus Brinkmann  <marcus@g10code.de>

	* client.cc (client_t::call_assuan): Send --nohup as argument to
	command.

	* client.h (class client_t): New members decrypt, verify, encrypt,
	and sign.
	* client.cc: Add implementations for these.
	* gpgex.h: Move all ID_CMD_* macros to ...
	* gpgex.cc: ... here.  Add new macros for new commands.
	(gpgex_t::InvokeCommand, gpgex_t::QueryContextMenu): Implement new
	commands.

	* Makefile.am (libgpg-error.a, libassuan.a): Use -f flag with ln.
	* registry.h (default_dir): New prototype.
	* registry.c (default_dir, standard_homedir): New functions.
	* client.cc (default_socket_name): Use default home dir instead
	install directory.

2007-09-05  Marcus Brinkmann  <marcus@g10code.de>

	* gpgex.h (class gpgex_t): Make destructor virtual to silence
	compiler warning.

	* Makefile.am (ICON_NAMES, ICON_SIZES, ICONS): New variables.
	(gpgex_SOURCES): Add $(ICONS).

	* Makefile.am (gpgex_LDADD): More -lws2_32 after ./libassuan.a.
	

2007-09-04  Marcus Brinkmann  <marcus@g10code.de>

	* Makefile.am (AM_CFLAGS, AM_CXXFLAGS): Remove $(GPGME_CFLAGS),
	add $(LIBASSUAN_CFLAGS) and $(GPG_ERROR_CFLAGS).
	(gpgex_SOURCES): Add client.h and client.cc.
	(libgpg-error.a, libassuan.a, clean-local): New targets.
	(gpgex_LDADD): Add ./libassuan.a and ./libgpg-error.a.
	* client.h, client.cc: New files.
	* gpgex.cc: Include client.h.
	(gpgex_t::InvokeCommand): Use client class to implement bunch of
	functionality.
	* main.h: Include <gpg-error.h>.
	(DEBUG_ASSUAN, REGKEY, TRACE_GPGERR): New macros.
	* main.cc: Include <gpg-error.h> and <assuan.h>.
	(REGKEY): Deleted.
	(debug_init): Free filename and add DEBUG_ASSUAN to debug flags.
	(DllMain): Set assuan log stream and prefix, and the error source.

2007-09-03  Marcus Brinkmann  <marcus@g10code.de>

	* bitmaps.h, bitmaps.cc, icons.rc, icon-key-12.bmp,
	icon-key-16.bmp: New files.
	* Makefile.am (gpgex_SOURCES): Add icons.rc, bitmaps.h and
	bitmaps.cc.
	(noinst_gpgex_SOURCES): Add versioninfo.rc.
	(gpgex_LDADD): Add -lgdi32.
	(resource.o): Remove target.
	* gpgex.h: Include bitmaps.h.
	(class gpgex_t): New member key_bitmap.
	(gpgex_t::gpgex_t, gpgex_t::~gpgex_t): Initialize and deinitialize
	it.
	* gpgex.cc (gpgex_t::QueryContextMenu): Add dummy bitmap for menu.

2007-08-31  Marcus Brinkmann  <marcus@g10code.de>

	* gpgex.cc (gpgex_t::QueryContextMenu): Fix menu separators.

2007-08-30  Marcus Brinkmann  <marcus@g10code.de>

	* gpgex.h (ID_CMD_HELP, ID_CMD_VERIFY_DECRYPT)
	(ID_CMD_SIGN_ENCRYPT, ID_CMD_IMPORT, ID_CMD_MAX)
	(ID_CMD_STR_HELP, ID_CMD_STR_VERIFY_DECRYPT)
	(ID_CMD_STR_SIGN_ENCRYPT, ID_CMD_STR_IMPORT): New macros.
	(class gpgex_t): New member ALL_FILES_GPG.
	* gpgex.cc (gpgex_t::reset): Initialize THIS->all_files_gpg.
	(gpgex_t::Initialize): Check ending of added files.
	(gpgex_t::QueryContextMenu): Create a more involved dummy menu.
	(gpgex_t::InvokeCommand): Show different commands being invoked.

	* gpgex-class.cc (gpgex_class::init): Also register the shell
	extension for directories.
	(gpgex_class::deinit): Unregister shell extension for directories.

2007-08-28  Marcus Brinkmann  <marcus@g10code.de>

	* main.cc (DllRegisterServer): Do not trash gpgex_server::instance.
	* gpgex-class.cc (gpgex_class::init): Now that DllMain loads, we
	can access the DLL file name.

	* main.cc (DllMain): Change return type to "STADPI" to get an
	extern "C" declaration.
	(_gpgex_debug): Remove lazy initialization cruft.  DllMain is
	called now, and initialization works properly.

	* Makefile.am (gpgex_LDADD): Add -lole32.
	* gpgex.def: Rename functions to not carry the @NR thingie.
	* main.h: Many TRACE macros added.
	(DEBUG_INIT, DEBUG_CONTEXT_MENU, STRINGIFY, GUID_FMT, GUID_ARG):
	New macros.
	(_gpgex_debug): New prototype.
	* main.cc: Include <stdarg.h>, <stdio.h> and <shlobj.h>.  Add
	debugging traces.	
	(debug_lock, debug_flags, debug_file): New statics.
	(get_debug_file, debug_init, debug_deinit): New static functions.
	(_gpgex_debug): New function.
	(DllMain): Call debug_init.
	(DllRegisterServer, DllUnregisterServer): Call SHChangeNotify.
	* gpgex.h: Include <vector> and <string>.  Use std::vector and
	std::string namespaces.
	(class gpgex_t): New member filenames, and new method reset.
	* gpgex.cc: Include <vector>, <string>, <stdexcept> and use
	std::vector and std::string namespaces.  Add debugging traces.
	(gpgex_t::reset): New function.
	(gpgex_t::Initialize): Implement dummy function.
	(gpgex_t::QueryContextMenu): Implement dummy function.
	(gpgex_t::GetCommandString): Implement dummy function.
	(gpgex_t::InvokeCommand): Implement dummy function.
	* gpgex-factory.cc: Add debugging traces.
	* gpgex-class.cc (gpgex_class::init): Implement registration of
	shell extension.
	(gpgex_class::deinit): Implement corresponding unregistration.

2007-08-23  Marcus Brinkmann  <marcus@g10code.de>

	* Initial commit.

